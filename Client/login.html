<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Acceso al Sistema - Autenticación</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: "#4f46e5",
                            "primary-dark": "#4338ca",
                        },
                    },
                },
            };
        </script>
    </head>
    <body
        class="bg-gray-50 font-sans min-h-screen flex items-center justify-center p-4 sm:p-6"
    >
        <div
            class="w-full max-w-md bg-white shadow-2xl rounded-xl overflow-hidden transform transition duration-500 hover:shadow-3xl"
        >
            <div class="bg-primary p-6 text-white text-center rounded-t-xl">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-10 h-10 mx-auto mb-2"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
                    />
                </svg>
                <h2 class="text-3xl font-extrabold">Iniciar Sesión</h2>
                <p class="text-indigo-200 text-sm mt-1">
                    Accede a tu cuenta de forma segura.
                </p>
            </div>

            <div class="p-8">
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label
                            for="sede-id"
                            class="block text-sm font-medium text-gray-700 mb-1"
                        >
                            ID de la sede
                        </label>
                        <input
                            type="text"
                            id="sede-id"
                            name="sede-id"
                            required
                            placeholder="SEDE-01"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary transition duration-150 ease-in-out placeholder-gray-400"
                        />
                    </div>

                    <div>
                        <label
                            for="password"
                            class="block text-sm font-medium text-gray-700 mb-1"
                        >
                            Contraseña
                        </label>
                        <input
                            type="password"
                            id="password"
                            name="password"
                            required
                            placeholder="••••••••"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-primary focus:border-primary transition duration-150 ease-in-out placeholder-gray-400"
                        />
                    </div>

                    <div
                        id="errorMessage"
                        class="hidden p-3 text-sm text-red-700 bg-red-100 rounded-lg border border-red-300"
                        role="alert"
                    >
                        Credenciales inválidas. Por favor, inténtalo de nuevo.
                    </div>

                    <div
                        id="successMessage"
                        class="hidden p-3 text-sm text-green-700 bg-green-100 rounded-lg border border-green-300"
                        role="alert"
                    >
                        ¡Acceso concedido! Token guardado. Serás redirigido...
                    </div>

                    <div>
                        <button
                            type="submit"
                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition duration-150 ease-in-out transform active:scale-95"
                        >
                            Acceder
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            const API_URL = "https://localhost:7205";
            const TOKEN_KEY = "access-token";
            const SEDE_KEY = "sede";
            const HOME_PAGE = "/index.html";

            const form = document.getElementById("loginForm");
            const errorMessage = document.getElementById("errorMessage");
            const successMessage = document.getElementById("successMessage");

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                errorMessage.classList.add("hidden");
                successMessage.classList.add("hidden");

                const id = document.getElementById("sede-id").value;
                const password = document.getElementById("password").value;

                try {
                    const response = await fetch(`${API_URL}/login`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ id, password }),
                    });

                    if (!response.ok) {
                        errorMessage.classList.remove("hidden");
                        errorMessage.innerHTML = "Error al iniciar sesión";
                        return;
                    }

                    const data = await response.json();
                    localStorage.setItem(TOKEN_KEY, data.token);
                    localStorage.setItem(SEDE_KEY, id);

                    successMessage.classList.remove("hidden");
                    console.log(
                        "Login exitoso. Token guardado. Redirigiendo...",
                    );
                    setTimeout(() => {
                        window.location.href = HOME_PAGE;
                    }, 1500);
                } catch (error) {
                    console.error(error);
                    errorMessage.classList.remove("hidden");
                    errorMessage.innerHTML = "Error al iniciar sesión";
                    return;
                }
            });

            window.onload = function () {
                if (localStorage.getItem(TOKEN_KEY)) {
                    console.log(
                        "Token encontrado al cargar, simulando redirección a la página principal.",
                    );
                    window.location.href = HOME_PAGE;
                }
            };
        </script>
    </body>
</html>
